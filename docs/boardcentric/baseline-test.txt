Wed Jan 28 14:38:12 EST 2026
--- npm test ---

> @cardplay/core@0.1.0 test
> vitest run

Testing types with tsc and vue-tsc is an experimental feature.
Breaking changes might not follow SemVer, please pin Vitest's version when using it.

 RUN  v1.6.1 /Users/halleyyoung/Documents/behavioral/cardplay

 ✓ src/ui/components/sample-browser.test.ts  (131 tests) 25ms
 ✓ src/cards/generators.test.ts  (164 tests) 25ms
 ✓ src/ui/components/arrangement-panel.test.ts  (238 tests) 27ms
 ✓ src/cards/card-visuals.test.ts  (162 tests) 23ms
 ✓ src/ui/components/piano-roll-panel.test.ts  (132 tests) 18ms
 ✓ src/ui/components/tracker-panel.test.ts  (139 tests) 35ms
 ✓ src/cards/transforms.test.ts  (123 tests) 17ms
 ✓ src/cards/arranger.test.ts  (222 tests) 29ms
 ✓ src/ui/session-view.test.ts  (166 tests) 23ms
 ✓ src/containers/container.test.ts  (75 tests) 21ms
 ✓ src/cards/effects.test.ts  (112 tests) 13ms
 ✓ src/cards/drum-machine.test.ts  (128 tests | 3 skipped) 23ms
 ✓ src/ui/cards.test.ts  (94 tests) 11ms
 ✓ src/notation/playback.test.ts  (75 tests) 11ms
 ✓ src/cards/presets.test.ts  (58 tests) 12ms
 ✓ src/notation/notation.test.ts  (96 tests) 16ms
 ✓ src/ui/beginner.test.ts  (73 tests) 14ms
 ✓ src/cards/bassline.test.ts  (144 tests | 2 skipped) 16ms
 ✓ src/cards/parameters.test.ts  (73 tests) 13ms
 ✓ src/audio/web-midi.test.ts  (54 tests) 10ms
 ✓ src/ui/achievements.test.ts  (71 tests) 19ms
 ✓ src/cards/lead-synth.test.ts  (105 tests) 16ms
 ✓ src/cards/organ.test.ts  (117 tests) 27ms
 ✓ src/audio/event-flattener.test.ts  (48 tests) 39ms
 ✓ src/cards/score-notation.test.ts  (45 tests) 13ms
 ✓ src/cards/pad-synth.test.ts  (107 tests) 29ms
 ✓ src/cards/loop-player.test.ts  (87 tests) 27ms
 ✓ src/cards/arpeggiator.test.ts  (88 tests | 2 skipped) 39ms
 ✓ src/cards/sequencer.test.ts  (79 tests | 2 skipped) 18ms
 ✓ src/cards/sampler.test.ts  (73 tests) 65ms
 ✓ src/ui/arrangement-operations.test.ts  (44 tests) 8ms
 ✓ src/cards/recording-manager.test.ts  (46 tests) 11ms
stderr | src/audio/drum-patterns.test.ts > Clip Creation > createArrangementClip > should return null for invalid pattern IDs
Pattern not found: nonexistent-pattern

stderr | src/audio/drum-patterns.test.ts > DrumPatternPlayer > should return false for unknown pattern ID
Pattern not found: nonexistent

 ✓ src/audio/drum-patterns.test.ts  (73 tests) 29ms
stderr | src/audio/drum-patterns.test.ts > Sampler Integration > quickPlayPattern > should return null for unknown pattern
Pattern not found: unknown

 ✓ src/ui/visualization.test.ts  (82 tests) 27ms
 ✓ src/cards/macro-controls.test.ts  (65 tests) 21ms
 ✓ src/audio/sampler-core.test.ts  (59 tests) 24ms
 ✓ src/ui/components.test.ts  (72 tests) 15ms
 ✓ src/cards/phrase-system.test.ts  (48 tests) 57ms
stdout | src/cards/phrase-system.test.ts > Phrase System > IdeaTool - rateIdea() > should accept rating for an idea
Rated idea idea-1769629097319 with 5 stars

 ✓ src/audio/midi-input-handler.test.ts  (40 tests) 84ms
 ✓ src/cards/chord-progression.test.ts  (70 tests | 2 skipped) 346ms
 ✓ src/cards/melody.test.ts  (71 tests | 2 skipped) 28ms
 ✓ src/user-cards/deck-template-advanced.test.ts  (42 tests) 12ms
 ✓ src/audio/audio-engine.test.ts  (49 tests) 9ms
 ✓ src/cards/drum-kit.test.ts  (62 tests) 14ms
 ✓ src/audio/wavetable.test.ts  (56 tests) 1608ms
 ✓ src/audio/sampler-modulation.test.ts  (56 tests) 31ms
 ✓ src/audio/sample-manipulation-ui.test.ts  (40 tests) 167ms
 ✓ src/ui/layout.test.ts  (66 tests) 13ms
 ✓ src/notation/editing.test.ts  (39 tests) 9ms
 ✓ src/cards/modulation.test.ts  (43 tests) 26ms
 ✓ src/audio/sample-editor.test.ts  (43 tests) 258ms
 ✓ src/cards/graph.test.ts  (32 tests) 24ms
 ✓ src/audio/scheduler.test.ts  (63 tests) 16ms
 ✓ src/ui/onboarding.test.ts  (49 tests) 27ms
 ✓ src/ui/session-recording.test.ts  (25 tests) 11ms
 ✓ src/audio/synth.test.ts  (56 tests) 21ms
 ✓ src/audio/audio-optimization.test.ts  (47 tests) 22ms
 ✓ src/audio/mixer.test.ts  (54 tests) 11ms
 ✓ src/audio/sample.test.ts  (51 tests) 9ms
 ✓ src/audio/freesound.test.ts  (37 tests) 11ms
 ✓ src/cards/registry.test.ts  (38 tests) 8ms
 ✓ src/ui/tooltips.test.ts  (43 tests) 8ms
 ✓ src/audio/sample-mapper.test.ts  (38 tests) 312ms
 ✓ src/streams/stream.test.ts  (35 tests) 15ms
 ✓ src/notation/event-bridge.test.ts  (29 tests) 9ms
 ✓ src/cards/audio-transforms.test.ts  (43 tests) 11ms
 ✓ src/cards/keyboard-instruments.test.ts  (47 tests) 17ms
 ✓ src/cards/card.test.ts  (23 tests) 10ms
 ❯ src/tests/integration-verification.test.ts  (12 tests | 12 failed) 10ms
   ❯ src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note creation from Tracker to PianoRoll
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
     → Cannot read properties of undefined (reading 'dispose')
   ❯ src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note edit from PianoRoll to Tracker
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
     → Cannot read properties of undefined (reading 'dispose')
   ❯ src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note deletion across views
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
     → Cannot read properties of undefined (reading 'dispose')
   ❯ src/tests/integration-verification.test.ts > V.2 Generator → Editor > should show generated events in editors
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.2 Generator → Editor > should allow freezing generated events into editable state
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.3 Session/Arrangement Clip Sharing > should share clips between Session and Arrangement
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.3 Session/Arrangement Clip Sharing > should handle clip deletion in both views
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.4 Selection Sync > should sync selection between views
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.5 Undo/Redo > should undo note creation
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.5 Undo/Redo > should undo edits regardless of which view made them
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > V.5 Undo/Redo > should handle batch operations in undo
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
   ❯ src/tests/integration-verification.test.ts > Integration Smoke Test > should handle a complete workflow
     → Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ✓ src/audio/sample-slicer.test.ts  (29 tests) 15ms
 ✓ src/ui/theme.test.ts  (55 tests) 22ms
 ✓ src/ui/components/export-dialog.test.ts  (49 tests) 243ms
stderr | src/audio/midi-mapping.test.ts > MIDI Mapping System > preset management > handles invalid JSON
Failed to parse MIDI preset JSON: SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
    at JSON.parse (<anonymous>)
    at Module.presetFromJSON (/Users/halleyyoung/Documents/behavioral/cardplay/src/audio/midi-mapping.ts:423:25)
    at /Users/halleyyoung/Documents/behavioral/cardplay/src/audio/midi-mapping.test.ts:350:14
    at file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:135:14
    at file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:60:26
    at runTest (file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:781:17)
    at runSuite (file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/halleyyoung/Documents/behavioral/cardplay/node_modules/@vitest/runner/dist/index.js:958:5)

 ✓ src/audio/midi-mapping.test.ts  (29 tests) 9ms
 ✓ src/storage/indexeddb-backend.test.ts  (24 tests) 88ms
 ✓ src/events/operations.test.ts  (40 tests) 9ms
 ✓ src/cards/phrase-midi.test.ts  (20 tests) 7ms
 ✓ src/audio/pitch-detect.test.ts  (43 tests) 72ms
 ✓ src/voices/voice.test.ts  (39 tests) 7ms
 ✓ src/cards/choir.test.ts  (29 tests) 11ms
 ✓ src/cards/stack.test.ts  (25 tests) 6ms
stdout | src/audio/worklet.test.ts > workletDebug > should not throw when enabled
[Worklet] test

 ✓ src/audio/worklet.test.ts  (35 tests) 13ms
 ✓ src/cards/adapter.test.ts  (28 tests) 11ms
 ✓ src/rules/rules.test.ts  (14 tests) 9ms
 ✓ src/audio/sample-pack-manager.test.ts  (33 tests) 223ms
 ✓ src/cards/protocol.test.ts  (29 tests) 6ms
 ✓ src/types/event.test.ts  (37 tests) 16ms
 ✓ src/notation/comparison-sync.test.ts  (18 tests) 5ms
 ✓ src/user-cards/card-metadata-ui.test.ts  (37 tests) 159ms
 ✓ src/audio/freesound-api.test.ts  (27 tests) 7ms
 ✓ src/user-cards/card-editor-panel.test.ts  (35 tests) 126ms
stdout | src/cards/testing/card-test.test.ts > Card Testing Framework > Test Runner > should run unit tests successfully
Result: {
  "cardId": "double-card",
  "cardName": "Double Card",
  "totalTests": 3,
  "passed": 3,
  "failed": 0,
  "skipped": 0,
  "duration": 0.17029199999888078,
  "results": [
    {
      "testId": "unit-1769629103217-0.711299872479272",
      "testName": "should double positive number",
      "testType": "unit",
      "passed": true,
      "duration": 0.04175000000032014,
      "output": 10
    },
    {
      "testId": "unit-1769629103217-0.7005467145128427",
      "testName": "should double negative number",
      "testType": "unit",
      "passed": true,
      "duration": 0.0073749999992287485,
      "output": -6
    },
    {
      "testId": "unit-1769629103217-0.8050830119051472",
      "testName": "should double zero",
      "testType": "unit",
      "passed": true,
      "duration": 0.004374999998617568,
      "output": 0
    }
  ],
  "qualityScore": 100
}

 ✓ src/cards/testing/card-test.test.ts  (15 tests) 14ms
 ✓ src/audio/context.test.ts  (24 tests) 108ms
 ✓ src/test-utils/test-utils.test.ts  (18 tests) 15ms
 ✓ src/cards/preset-sync.test.ts  (14 tests) 115ms
 ✓ src/user-cards/template-preview.test.ts  (11 tests) 3ms
 ✓ src/events/serialization.test.ts  (13 tests) 5ms
 ✓ src/user-cards/pack-ratings.test.ts  (10 tests) 3ms
 ✓ src/user-cards/pack-discovery.test.ts  (9 tests) 6ms
 ✓ src/user-cards/pack-stats.test.ts  (7 tests) 5ms
 ✓ src/audio/sample-packs.test.ts  (18 tests) 597ms
stdout | src/audio/sample-packs.test.ts > Sample Pack System > SamplePackLoader > should track load progress
Pack loading skipped in test (network required)

 ✓ src/ui/components/sample-waveform-preview.test.ts  (70 tests) 711ms
 ✓ src/audio/export.test.ts  (23 tests) 4442ms

⎯⎯⎯⎯⎯⎯ Failed Tests 12 ⎯⎯⎯⎯⎯⎯⎯

 FAIL  src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note creation from Tracker to PianoRoll
 FAIL  src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note edit from PianoRoll to Tracker
 FAIL  src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note deletion across views
Error: Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ❯ TracingChannel.traceSync node:diagnostics_channel:328:14
 ❯ Module.resetAllState src/state/index.ts:129:50
    127|  */
    128| export function resetAllState(): void {
    129|   const { resetSharedEventStore: resetEvents } = require('./event-stor…
       |                                                  ^
    130|   const { resetSelectionStore: resetSelection } = require('./selection…
    131|   const { resetClipRegistry: resetClips } = require('./clip-registry');
 ❯ src/tests/integration-verification.test.ts:60:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts' ] }
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[1/15]⎯

 FAIL  src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note creation from Tracker to PianoRoll
 FAIL  src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note edit from PianoRoll to Tracker
 FAIL  src/tests/integration-verification.test.ts > V.1 Cross-View Sync > should sync note deletion across views
TypeError: Cannot read properties of undefined (reading 'dispose')
 ❯ src/tests/integration-verification.test.ts:76:20
     74| 
     75|   afterEach(() => {
     76|     trackerAdapter.dispose();
       |                    ^
     77|     pianoRollAdapter.dispose();
     78|   });

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[2/15]⎯

 FAIL  src/tests/integration-verification.test.ts > V.2 Generator → Editor > should show generated events in editors
 FAIL  src/tests/integration-verification.test.ts > V.2 Generator → Editor > should allow freezing generated events into editable state
Error: Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ❯ TracingChannel.traceSync node:diagnostics_channel:328:14
 ❯ Module.resetAllState src/state/index.ts:129:50
    127|  */
    128| export function resetAllState(): void {
    129|   const { resetSharedEventStore: resetEvents } = require('./event-stor…
       |                                                  ^
    130|   const { resetSelectionStore: resetSelection } = require('./selection…
    131|   const { resetClipRegistry: resetClips } = require('./clip-registry');
 ❯ src/tests/integration-verification.test.ts:124:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts' ] }
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[3/15]⎯

 FAIL  src/tests/integration-verification.test.ts > V.3 Session/Arrangement Clip Sharing > should share clips between Session and Arrangement
 FAIL  src/tests/integration-verification.test.ts > V.3 Session/Arrangement Clip Sharing > should handle clip deletion in both views
Error: Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ❯ TracingChannel.traceSync node:diagnostics_channel:328:14
 ❯ Module.resetAllState src/state/index.ts:129:50
    127|  */
    128| export function resetAllState(): void {
    129|   const { resetSharedEventStore: resetEvents } = require('./event-stor…
       |                                                  ^
    130|   const { resetSelectionStore: resetSelection } = require('./selection…
    131|   const { resetClipRegistry: resetClips } = require('./clip-registry');
 ❯ src/tests/integration-verification.test.ts:193:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts' ] }
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[4/15]⎯

 FAIL  src/tests/integration-verification.test.ts > V.4 Selection Sync > should sync selection between views
Error: Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ❯ TracingChannel.traceSync node:diagnostics_channel:328:14
 ❯ Module.resetAllState src/state/index.ts:129:50
    127|  */
    128| export function resetAllState(): void {
    129|   const { resetSharedEventStore: resetEvents } = require('./event-stor…
       |                                                  ^
    130|   const { resetSelectionStore: resetSelection } = require('./selection…
    131|   const { resetClipRegistry: resetClips } = require('./clip-registry');
 ❯ src/tests/integration-verification.test.ts:287:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts' ] }
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[5/15]⎯

 FAIL  src/tests/integration-verification.test.ts > V.5 Undo/Redo > should undo note creation
 FAIL  src/tests/integration-verification.test.ts > V.5 Undo/Redo > should undo edits regardless of which view made them
 FAIL  src/tests/integration-verification.test.ts > V.5 Undo/Redo > should handle batch operations in undo
Error: Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ❯ TracingChannel.traceSync node:diagnostics_channel:328:14
 ❯ Module.resetAllState src/state/index.ts:129:50
    127|  */
    128| export function resetAllState(): void {
    129|   const { resetSharedEventStore: resetEvents } = require('./event-stor…
       |                                                  ^
    130|   const { resetSelectionStore: resetSelection } = require('./selection…
    131|   const { resetClipRegistry: resetClips } = require('./clip-registry');
 ❯ src/tests/integration-verification.test.ts:340:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts' ] }
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[6/15]⎯

 FAIL  src/tests/integration-verification.test.ts > Integration Smoke Test > should handle a complete workflow
Error: Cannot find module './event-store'
Require stack:
- /Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts
 ❯ TracingChannel.traceSync node:diagnostics_channel:328:14
 ❯ Module.resetAllState src/state/index.ts:129:50
    127|  */
    128| export function resetAllState(): void {
    129|   const { resetSharedEventStore: resetEvents } = require('./event-stor…
       |                                                  ^
    130|   const { resetSelectionStore: resetSelection } = require('./selection…
    131|   const { resetClipRegistry: resetClips } = require('./clip-registry');
 ❯ src/tests/integration-verification.test.ts:444:5

⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯
Serialized Error: { code: 'MODULE_NOT_FOUND', requireStack: [ '/Users/halleyyoung/Documents/behavioral/cardplay/src/state/index.ts' ] }
⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯⎯[7/15]⎯

 Test Files  1 failed | 101 passed (102)
      Tests  12 failed | 6049 passed | 13 skipped (6074)
Type Errors  no errors
   Start at  14:38:13
   Duration  13.92s (transform 7.58s, setup 10ms, collect 14.84s, tests 11.11s, environment 353ms, prepare 9.27s)

EXIT_CODE=1
